{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vaudreuil Forum</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- CSS Styles -->
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  <link rel="stylesheet" href="{% static 'css/layout.css' %}">
  <link rel="stylesheet" href="{% static 'css/components.css' %}">
  <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
</head>
<body>

  <div class="container">
    
    <!-- Header -->
    <header class="header">
      <h1>Vaudreuil Forum</h1>
      <label>
        <input type="checkbox" id="theme-toggle"> ðŸŒ— Dark Mode
      </label>
    </header>

    <!-- Navigation -->
    {% if user.is_authenticated %}
      {% include "includes/nav_user.html" %}
    {% else %}
      {% include "includes/nav_guest.html" %}
    {% endif %}

    <!-- Global Announcements -->
    {% if global_announcements %}
      <section class="card" style="margin-top: 1rem;">
        <h3>ðŸ“¢ Announcements</h3>
        <ul style="list-style: none; padding-left: 0;">
          {% for a in global_announcements %}
            <li id="announcement-{{ a.id }}">
              <strong>{{ a.title }}</strong>: {{ a.body }}
              <button onclick="markRead('{{ a.id }}')" class="button small" style="float:right;">Dismiss</button>
            </li>
          {% endfor %}
        </ul>
      </section>
    {% endif %}

    <!-- Main Content -->
    <main class="main">
      {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer text-center">
      &copy; 2025 Vaudreuil Community
    </footer>

  </div>

  <!-- Theme Toggle JS -->
  <script src="{% static 'css/theme-toggle.js' %}"></script>

  <!-- Dismiss Announcement -->
  <script>
    function markRead(id) {
      fetch("{% url 'accounts:mark_announcement_read' 0 %}".replace(0, id), {
        method: "POST",
        headers: {
          "X-CSRFToken": "{{ csrf_token }}",
        }
      }).then(res => {
        if (res.ok) {
          document.getElementById(`announcement-${id}`).remove();
        }
      });
    }
  </script>

</body>
</html>
